pipeline {
  agent {
    label 'windows'
  }

  tools {
    nodejs 'NodeJS'
    maven 'mvn'
  }

  stages {
    //stage('Install Appium') {
      //steps {
       // bat 'npm install -g appium'
       // script {
         // try {
          //  bat 'appium driver install uiautomator2'
          //} catch (err) {}
       // }
     // }
   // }

   // stage('Download Images') {
     // steps {
       // bat 'sdkmanager %image%'
     // }
   // }

    stage('Emulator & Appium (Parallel)') {
      parallel {
        stage('Create Emulator') {
          steps {
            //bat 'avdmanager -s create avd -c 100M -k %image% -n %AVD% --force'
            bat 'emulator -avd %AVD% -no-window -gpu off'
          }
        }

        stage('Start Appium') {
          steps {
            bat 'appium'
          }
        }

        /*stage('Run Tests') {
          steps {
            script {
              bat 'powershell -command "Start-Sleep -s 250"'
              bat 'mvn clean test'
            }
          }

          post {
            always {
              script {
                bat 'taskkill /F /IM node.exe /T'
                bat 'taskkill /F /IM emulator.exe /T'
              }
            }
          }
        }*/
      }
    }
  }

}
